<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>		
		chart {
			display: block;
			margin-left:auto; 
			margin-right: auto;
		}
		
		text {
			text-anchor: middle;
			fill: #8A0707;
			font-size: 28px;
			/*font-weight: 700;*/
			opacity: 0.9;
		}

		path{
			stroke: #8A0707;
			stroke-width: 1;
			fill: none;
			opacity: 0.4;
		}

		circle {
			fill: #8A0707;
			opacity: 0.9;
		}
	</style>

	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Medula+One' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Ovo' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="stylesheets/index.css" />
    <title>Who is Cassie?</title>
</head>
<body class="bogon">
    <div class="center">
        <div class="center" id="chart"></div>
        <h1>
            Cassie Wang
        </h1>

        <p id="links">
        <a href="#who" data-selector="#who" data-media="who">Who?</a> 
        </p>
        <div id="detail">
            <div id="who">
                <p>
                She is an angel.  She is my soulmate.</p>
                <p>
                I don't know when I know her but I guess it's from the day when there's light. &#10024; &#10024;</p>
                <p>
                Oh, we actually met on May 22, 2022. It's been <span id="num-days"></span> days and going! </p>
            </div>
        </div>
        <canvas id='myCanvas' width='800' height='600'></canvas>
        <canvas id="scene" width="480" height="300"></canvas>

        <div class="footer">
        </div>
    </div>
<script>
const endAngle = 226;
let canvas = document.getElementById('myCanvas');
let context = canvas.getContext('2d');
let counter = 60;
let radius, tx, ty;
context.translate(tx, ty);
randomize();
requestAnimationFrame(animate);
 
function animate() {
  let x, y;
  if (counter <= endAngle) {
    let radians = Math.PI / 180 * counter;
    y = radius * Math.sin(radians);
    x = radius * Math.cos(radians);
    context.fillRect(radius / 2 - x, -y, 2, 2);
    context.fillRect(-radius / 2 + x, -y, 2, 2);
  } else {
    x = counter - endAngle - radius * 1.2;
    y = counter - endAngle + radius * .71;
    context.fillRect(x, y, 2, 2);
    context.fillRect(-x, y, 2, 2);
  }
  counter = counter + 1;
  if (counter >= endAngle + radius * 1.2) randomize();
  requestAnimationFrame(animate);
}
 
function randomize() {
  counter = 60;
  context.fillStyle = 'rgba(255,' + Math.floor(Math.random() * 255) + ', 255 ,1)';
  radius = Math.random() * 100;
  context.translate(-tx, -ty);
  tx = Math.random() * canvas.width;
  ty = Math.random() * canvas.height;
  context.translate(tx, ty);
}
</script>

    <script type="text/javascript">
        window.onerror = function() {
            location.reload();
        }

        var date1 = new Date("05/22/2022");
        var date2 = new Date();
        var diff_days = Math.ceil((date2.getTime() - date1.getTime())  / (1000 * 3600 * 24));
        document.getElementById('num-days').innerHTML = diff_days
        
        var margin = {top: 10, right: 10, bottom: 10, left: 10},
            docHeight = 480,
            docWidth  = 480;
        
        var	minSize = Math.min(500,(docWidth-40),(docHeight-40)),
            width = minSize,
            height = minSize;
         
        //Create the datapoints with x en y positions for the circles 
        //Formula from http://mathworld.wolfram.com/HeartCurve.html
        var x, y;
        var data = [];
        for (var i = 0; i < 350; i++) {
            x = 16 * Math.pow(Math.sin(i),3);
            y = 13 * Math.cos(i) - 5* Math.cos(2*i) - 2 * Math.cos(3*i) - Math.cos(4*i)
            data[i] = [x,y];
        }//for i

        //Scales
        var xScale = d3.scale.linear()
                  .domain([d3.min(data, function(d) { return d[0]; }), d3.max(data, function(d) { return d[0]; })])
                  .range([ 0, width ]);

        var yScale = d3.scale.linear()
                  .domain([d3.min(data, function(d) { return d[1]; }), d3.max(data, function(d) { return d[1]; })])
                  .range([ height, 0 ]);

        //Initiate the SVG
        var chart = d3.select('#chart')
            .append('svg')
            .attr('width', docWidth)
            .attr('height', docHeight)
            .attr('class', 'chart')
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            
        //Initiate the group that will hold all the dots and lines
        var svg = chart.append('g')
            .attr('transform', 'translate(' + (docWidth/2-width/2) + ',' + (docHeight/2-height/2) + ')')
            .attr('width', width)
            .attr('height', height); 
        
        //Create the dots that make the heart	  
        var dots = svg.append("g").selectAll("circle")
              .data(data)
              .enter().append("circle")
                  .attr("cx", function (d,i) { return xScale(d[0]); } )
                  .attr("cy", function (d) { return yScale(d[1]); } )
                  .attr("r", 2);

        //Create and draw the path that connects the dots
        //From: http://stackoverflow.com/questions/13893127/how-to-draw-a-path-smoothly-from-start-point-to-end-point-in-d3-js
        var line = d3.svg.line()
                  .interpolate('linear')
                  .x(function(d){ return xScale(d[0]) })
                  .y(function(d){ return yScale(d[1]) });
                  
        var path = svg.append("g").append("path")
              .attr("d", line(data));
              
        var totalLength = path.node().getTotalLength();	  
        path
          .attr("stroke-dasharray", totalLength + " " + totalLength)
          .attr("stroke-dashoffset", totalLength)
          .transition()
            .duration(3e4).delay(500)
            .ease("linear")
            .attr("stroke-dashoffset", 0);
    </script>

    <script type="text/javascript" src="javascripts/wave.js"></script>
    <script type="text/javascript" src="javascripts/scene.js"></script>
</body>
</html>
